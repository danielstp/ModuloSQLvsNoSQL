# create two images, Django and mariadb
services:
  django:
    build:
      context: .
      #target: localhost/prueba_django
    ports:
      - 8000:8000
    image: localhost/prueba_django
    container_name: prueba_django
    networks:
      - django-sql-network
    environment:
      - DB_HOSTNAME=db
    depends_on:
      - db
    stdin_open: true  # docker run -i
    tty: true         # docker run -t
  db:
    image: docker.io/library/postgres:16
    restart: unless-stopped
    environment:
      - POSTGRES_DB=rentadvds
      - POSTGRES_USER=prueba
      - POSTGRES_PASSWORD=prueba
      - POSTGRES_HOST_AUTH_METHOD=scram-sha-256
      - POSTGRES_INITDB_ARGS=--auth-host=scram-sha-256
      - TZ=America/Bogota
    networks:
      - django-sql-network
    container_name: db
    volumes:
      - ./datadir:/var/lib/postgresql/data:rw
    stdin_open: false  # docker run -i
    tty: false         # docker run -t

# connect both containers to this network
networks:
  django-sql-network:
    name: django-sql-network
